{"ast":null,"code":"import * as React from 'react';\nimport { createStore } from '..';\nimport { getDisplayName, mapValues } from '../utils';\nexport function createConnectedStoreAs(initialStates, effects) {\n  let Context = React.createContext({\n    __MISSING_PROVIDER__: true\n  });\n\n  class Container extends React.Component {\n    constructor(props) {\n      super(props); // Create store definition from initial state\n\n      let states = props.initialStates || initialStates;\n      let stores = mapValues(states, _ => createStore(_)); // Apply effects?\n\n      let fx = props.effects || effects;\n\n      if (fx) {\n        fx(stores); // TODO\n      }\n\n      this.state = {\n        storeDefinitions: stores,\n        // TODO\n        storeSnapshots: mapValues(stores, _ => _.getCurrentSnapshot()),\n        subscriptions: mapValues(stores, (_, k) => _.onAll().subscribe(() => this.setState(state => ({\n          storeSnapshots: Object.assign({}, state.storeSnapshots, {\n            [k]: _.getCurrentSnapshot()\n          })\n        }))))\n      };\n    }\n\n    componentWillUnmount() {\n      mapValues(this.state.subscriptions, _ => _.unsubscribe()); // Let the state get GC'd.\n      // TODO: Find a more elegant way to do this.\n\n      if (this.state.storeSnapshots) {}\n\n      mapValues(this.state.storeSnapshots, _ => _.state = null);\n      mapValues(this.state.storeSnapshots, _ => _.storeDefinition = null);\n      mapValues(this.state.storeDefinitions, _ => _.storeSnapshot = null);\n    }\n\n    render() {\n      return React.createElement(Context.Provider, {\n        value: this.state.storeSnapshots\n      }, this.props.children);\n    }\n\n  }\n\n  let Consumer = props => React.createElement(Context.Consumer, null, stores => {\n    if (!isInitialized(stores)) {\n      throw Error(`[Undux] Component \"${props.displayName}\" does not seem to be nested in an Undux <Container>. To fix this error, be sure to render the component in the <Container>...</Container> component that you got back from calling createConnectedStoreAs().`);\n    }\n\n    return props.children(stores);\n  });\n\n  function withStores(Component) {\n    let displayName = getDisplayName(Component);\n\n    let f = props => React.createElement(Consumer, {\n      displayName: displayName\n    }, stores => React.createElement(Component, Object.assign({}, stores, props)));\n\n    f.displayName = `withStores(${displayName})`;\n    return f;\n  }\n\n  return {\n    Container,\n\n    useStores() {\n      return React.useContext(Context);\n    },\n\n    withStores\n  };\n}\n\nfunction isInitialized(store) {\n  return !('__MISSING_PROVIDER__' in store);\n}","map":{"version":3,"sources":["../../src/react/createConnectedStoreAs.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import * as React from 'react';\nimport { createStore } from '..';\nimport { getDisplayName, mapValues } from '../utils';\nexport function createConnectedStoreAs(initialStates, effects) {\n    let Context = React.createContext({ __MISSING_PROVIDER__: true });\n    class Container extends React.Component {\n        constructor(props) {\n            super(props);\n            // Create store definition from initial state\n            let states = props.initialStates || initialStates;\n            let stores = mapValues(states, _ => createStore(_));\n            // Apply effects?\n            let fx = props.effects || effects;\n            if (fx) {\n                fx(stores); // TODO\n            }\n            this.state = {\n                storeDefinitions: stores,\n                // TODO\n                storeSnapshots: mapValues(stores, _ => _.getCurrentSnapshot()),\n                subscriptions: mapValues(stores, (_, k) => _.onAll().subscribe(() => this.setState(state => ({\n                    storeSnapshots: Object.assign({}, state.storeSnapshots, {\n                        [k]: _.getCurrentSnapshot()\n                    })\n                }))))\n            };\n        }\n        componentWillUnmount() {\n            mapValues(this.state.subscriptions, _ => _.unsubscribe());\n            // Let the state get GC'd.\n            // TODO: Find a more elegant way to do this.\n            if (this.state.storeSnapshots) {\n            }\n            mapValues(this.state.storeSnapshots, _ => (_.state = null));\n            mapValues(this.state.storeSnapshots, _ => (_.storeDefinition = null));\n            mapValues(this.state.storeDefinitions, _ => (_.storeSnapshot = null));\n        }\n        render() {\n            return (React.createElement(Context.Provider, { value: this.state.storeSnapshots }, this.props.children));\n        }\n    }\n    let Consumer = (props) => (React.createElement(Context.Consumer, null, stores => {\n        if (!isInitialized(stores)) {\n            throw Error(`[Undux] Component \"${props.displayName}\" does not seem to be nested in an Undux <Container>. To fix this error, be sure to render the component in the <Container>...</Container> component that you got back from calling createConnectedStoreAs().`);\n        }\n        return props.children(stores);\n    }));\n    function withStores(Component) {\n        let displayName = getDisplayName(Component);\n        let f = props => (React.createElement(Consumer, { displayName: displayName }, stores => React.createElement(Component, Object.assign({}, stores, props))));\n        f.displayName = `withStores(${displayName})`;\n        return f;\n    }\n    return {\n        Container,\n        useStores() {\n            return React.useContext(Context);\n        },\n        withStores\n    };\n}\nfunction isInitialized(store) {\n    return !('__MISSING_PROVIDER__' in store);\n}\n//# sourceMappingURL=createConnectedStoreAs.js.map"]},"metadata":{},"sourceType":"module"}