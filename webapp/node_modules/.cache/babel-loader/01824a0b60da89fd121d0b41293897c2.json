{"ast":null,"code":"import * as React from 'react';\nimport { createStore } from '..';\nimport { getDisplayName } from '../utils';\nexport function createConnectedStore(initialState, effects) {\n  let Context = React.createContext({\n    __MISSING_PROVIDER__: true\n  });\n\n  class Container extends React.Component {\n    constructor(props) {\n      super(props); // Create store definition from initial state\n\n      let state = props.initialState || initialState;\n      this.storeDefinition = createStore(state); // Apply effects?\n\n      let fx = props.effects || effects;\n\n      if (fx) {\n        fx(this.storeDefinition);\n      }\n\n      this.state = {\n        storeSnapshot: this.storeDefinition.getCurrentSnapshot()\n      };\n      this.subscription = this.storeDefinition.onAll().subscribe(() => this.setState({\n        storeSnapshot: this.storeDefinition.getCurrentSnapshot()\n      }));\n    }\n\n    componentWillUnmount() {\n      this.subscription.unsubscribe();\n      this.storeDefinition.storeSnapshot = null;\n      this.storeDefinition = null;\n    }\n\n    render() {\n      return React.createElement(Context.Provider, {\n        value: this.state.storeSnapshot\n      }, this.props.children);\n    }\n\n  }\n\n  let Consumer = props => React.createElement(Context.Consumer, null, store => {\n    if (!isInitialized(store)) {\n      throw Error(`[Undux] Component \"${props.displayName}\" does not seem to be nested in an Undux <Container>. To fix this error, be sure to render the component in the <Container>...</Container> component that you got back from calling createConnectedStore().`);\n    }\n\n    return props.children(store);\n  });\n\n  function withStore(Component) {\n    let displayName = getDisplayName(Component);\n\n    let f = props => React.createElement(Consumer, {\n      displayName: displayName\n    }, storeSnapshot => React.createElement(Component, Object.assign({\n      store: storeSnapshot\n    }, props)));\n\n    f.displayName = `withStore(${displayName})`;\n    return f;\n  }\n\n  return {\n    Container,\n\n    useStore() {\n      return React.useContext(Context);\n    },\n\n    withStore\n  };\n}\n\nfunction isInitialized(store) {\n  return !('__MISSING_PROVIDER__' in store);\n}","map":{"version":3,"sources":["../../src/react/createConnectedStore.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,KAAZ,MAAuB,OAAvB;AAEA,SAAS,WAAT,QAA4E,IAA5E;AACA,SAAe,cAAf,QAAqC,UAArC;AAeA,OAAM,SAAU,oBAAV,CACJ,YADI,EAEJ,OAFI,EAEoB;AAExB,MAAI,OAAO,GAAG,KAAK,CAAC,aAAN,CAAoB;AAAE,IAAA,oBAAoB,EAAE;AAAxB,GAApB,CAAd;;AAMA,QAAM,SAAN,SAAwB,KAAK,CAAC,SAA9B,CAGC;AAGC,IAAA,WAAA,CAAY,KAAZ,EAAwC;AACtC,YAAM,KAAN,EADsC,CAGtC;;AACA,UAAI,KAAK,GAAG,KAAK,CAAC,YAAN,IAAsB,YAAlC;AACA,WAAK,eAAL,GAAuB,WAAW,CAAC,KAAD,CAAlC,CALsC,CAOtC;;AACA,UAAI,EAAE,GAAG,KAAK,CAAC,OAAN,IAAiB,OAA1B;;AACA,UAAI,EAAJ,EAAQ;AACN,QAAA,EAAE,CAAC,KAAK,eAAN,CAAF;AACD;;AAED,WAAK,KAAL,GAAa;AACX,QAAA,aAAa,EAAE,KAAK,eAAL,CAAqB,kBAArB;AADJ,OAAb;AAIA,WAAK,YAAL,GAAoB,KAAK,eAAL,CAAqB,KAArB,GAA6B,SAA7B,CAAuC,MACzD,KAAK,QAAL,CAAc;AACZ,QAAA,aAAa,EAAE,KAAK,eAAL,CAAqB,kBAArB;AADH,OAAd,CADkB,CAApB;AAKD;;AAED,IAAA,oBAAoB,GAAA;AAClB,WAAK,YAAL,CAAkB,WAAlB;AAGE,WAAK,eAAL,CAA6B,aAA7B,GAA6C,IAA7C;AACA,WAAa,eAAb,GAA+B,IAA/B;AACH;;AAED,IAAA,MAAM,GAAA;AACJ,aACE,KAAA,CAAA,aAAA,CAAC,OAAO,CAAC,QAAT,EAAiB;AAAC,QAAA,KAAK,EAAE,KAAK,KAAL,CAAW;AAAnB,OAAjB,EACG,KAAK,KAAL,CAAW,QADd,CADF;AAKD;;AAzCF;;AA4CD,MAAI,QAAQ,GAAI,KAAD,IAIb,KAAA,CAAA,aAAA,CAAC,OAAO,CAAC,QAAT,EAAiB,IAAjB,EACG,KAAK,IAAG;AACP,QAAI,CAAC,aAAa,CAAC,KAAD,CAAlB,EAA2B;AACzB,YAAM,KAAK,CACT,sBAAsB,KAAK,CAAC,WAAW,6MAD9B,CAAX;AAGD;;AACD,WAAO,KAAK,CAAC,QAAN,CAAe,KAAf,CAAP;AACD,GARH,CAJF;;AAgBA,WAAS,SAAT,CAIE,SAJF,EAIuC;AAErC,QAAI,WAAW,GAAG,cAAc,CAAC,SAAD,CAAhC;;AACA,QAAI,CAAC,GAAgD,KAAK,IACxD,KAAA,CAAA,aAAA,CAAC,QAAD,EAAS;AAAC,MAAA,WAAW,EAAE;AAAd,KAAT,EACG,aAAa,IACZ,KAAA,CAAA,aAAA,CAAC,SAAD,EAAU,MAAA,CAAA,MAAA,CAAA;AAAC,MAAA,KAAK,EAAE;AAAR,KAAA,EAA4B,KAA5B,CAAV,CAFJ,CADF;;AAOA,IAAA,CAAC,CAAC,WAAF,GAAgB,aAAa,WAAW,GAAxC;AACA,WAAO,CAAP;AACD;;AAED,SAAO;AACL,IAAA,SADK;;AAEL,IAAA,QAAQ,GAAA;AACN,aAAO,KAAK,CAAC,UAAN,CAAiB,OAAjB,CAAP;AACD,KAJI;;AAKL,IAAA;AALK,GAAP;AAOD;;AAED,SAAS,aAAT,CACE,KADF,EAC8D;AAE5D,SAAO,EAAE,0BAA0B,KAA5B,CAAP;AACD","sourceRoot":"","sourcesContent":["import * as React from 'react';\nimport { createStore } from '..';\nimport { getDisplayName } from '../utils';\nexport function createConnectedStore(initialState, effects) {\n    let Context = React.createContext({ __MISSING_PROVIDER__: true });\n    class Container extends React.Component {\n        constructor(props) {\n            super(props);\n            // Create store definition from initial state\n            let state = props.initialState || initialState;\n            this.storeDefinition = createStore(state);\n            // Apply effects?\n            let fx = props.effects || effects;\n            if (fx) {\n                fx(this.storeDefinition);\n            }\n            this.state = {\n                storeSnapshot: this.storeDefinition.getCurrentSnapshot()\n            };\n            this.subscription = this.storeDefinition.onAll().subscribe(() => this.setState({\n                storeSnapshot: this.storeDefinition.getCurrentSnapshot()\n            }));\n        }\n        componentWillUnmount() {\n            this.subscription.unsubscribe();\n            this.storeDefinition.storeSnapshot = null;\n            this.storeDefinition = null;\n        }\n        render() {\n            return (React.createElement(Context.Provider, { value: this.state.storeSnapshot }, this.props.children));\n        }\n    }\n    let Consumer = (props) => (React.createElement(Context.Consumer, null, store => {\n        if (!isInitialized(store)) {\n            throw Error(`[Undux] Component \"${props.displayName}\" does not seem to be nested in an Undux <Container>. To fix this error, be sure to render the component in the <Container>...</Container> component that you got back from calling createConnectedStore().`);\n        }\n        return props.children(store);\n    }));\n    function withStore(Component) {\n        let displayName = getDisplayName(Component);\n        let f = props => (React.createElement(Consumer, { displayName: displayName }, storeSnapshot => (React.createElement(Component, Object.assign({ store: storeSnapshot }, props)))));\n        f.displayName = `withStore(${displayName})`;\n        return f;\n    }\n    return {\n        Container,\n        useStore() {\n            return React.useContext(Context);\n        },\n        withStore\n    };\n}\nfunction isInitialized(store) {\n    return !('__MISSING_PROVIDER__' in store);\n}\n//# sourceMappingURL=createConnectedStore.js.map"]},"metadata":{},"sourceType":"module"}